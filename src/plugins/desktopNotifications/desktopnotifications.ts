class KoreDesktopNotificationPlugin {
    name: string = 'KoreDesktopNotificationPlugin ';
    config: any = {};
    isTabActive: boolean = true;

    notificationSound = 'data:audio/mp3;base64,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zAAsn0RSRtagYAuIngKTAwGaIivmbabacEwyMwBM8RZuAjDHziuNGS00SpIWLiRqtQ3/+5Bk+4Hz2WjQ+4+kKAAADSAAAAEoZaM57u31qAAANIAAAARaubXxcM5xnT/k4ECrXOln626P9Ymoyf84BTGikP/6gmIPhw8////6/6BGUrUQ3///o7t648aACIsySkldHGJGyt2mD1WQY0yJxAONkjeUgJmZmOHMAbW1v6zEnzPOtWZG3UQUe/5GDB+s9+WfNv8olX+pAEIyESNm//cZ8KwI41S/////zh7EyrzPywACj9EAGCzyt2zWacgFsypOVRb/WiOhwOalvhYAO6J0gJGSPzRQQTB9lS0W5MayKk71EOK38ag899vyy/Kn+Yt/Y2IIRczJ3/9kwxoCk0hxfV/////kONa9EaDIALDAAAu4AAAC/cOxGCmi1LpeYZAEwfCgwXAQwvHI5lQUw5AYvSy6Ky6zR3aZwZ9BJST1CPhvOZESIk/Mkv4RDCS809tbCmjbpHBQb/zFv6aAauIsxk/bqWgmYDlgV/AfgSHxBwZon/////VrywRX///rgImZIAA/oAAABu7hG1MOoxPCXt67ZEPQcGQoawLDhwBulHb/+2Bk2oTzTlBU+0lsMAAADSAAAAEK1TVV7RpwoAAANIAAAAS2OjOxYdBlmx9JYpq+j9v4d416f9cokLZZHf6/+susr6vqWcI8CEgG9SfDznn/////9Wok///+WoG+AAl7AG+oSLSR/14St9GViACDDELxIDzCweD1hgzFYCBYD1+OXFJ92IYttyokVJqN6QXCDCZTP679ajEIg4PurNOps6sdAZVA3KAZZQ///U7s/O+6lmQxoGAWYBq0JhAAQRBIiJsi///9f1fqqJUcpf//////y7WYiZhQAFfwAAAos8951IpK4bfWRt3jT2LAM9BJDOAxCMj3JlJim9sGRWf3cp7cfnL/+2Bk6oDy81DUe2mkGAAADSAAAAEOVUM/4PaHoAAANIAAAASbtmAjIqGaamq09mTQwyQSdW/9cahC1OLc/////69AzKYDzAF/YZdFSWg3/////XsQjf//6Zi7lzAAL+AS29luAkTkbS1rVExe7jzrOi3UwgdBIYh+Ya0DoSYRDHXFz73foER8A8jZeTDSIrp1HXtFlJWZFaAhEIOTa3+sdRElsYlX////+io2kNIgAacA3pwMsk4TwOu//+K///9ygAAJUAKOBaGAD3/JkuLMBumBEhzQtyAPSGG5ofZy4YGyWk/sIIKZf/nERN7/////6mHioAWCnEGJj8AADjgaKqBpJFr/+2Bk8oHy1lDReFyh2AAADSAAAAEPFZc5oXanoAAANIAAAASU1UxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+1Bk+QHzKFDQ+xyjqAAADSAAAAEM9PFD7TKQ4AAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuOTku//sgZOiD8c88UPogVZgAAA0gAAABAWgrPoGBIWAAADSAAAAENVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EGTdj/AAAH+AAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQZN2P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+xBk3Y/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EGTdj/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQZN2P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+xBk3Y/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EGTdj/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQZN2P8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUQUcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/w==';
    constructor() {}

    onHostCreate() {
        this.onInit();
    }
    onInit() {
        let me: any = this;

        if (Notification.permission === "default") {
            Notification.requestPermission();
        }

        document.addEventListener("visibilitychange", (event) => {
            if (document.visibilityState == "visible") {
              me.isTabActive = true;
            } else {
              me.isTabActive = false;
            }
          });

        me.hostInstance.on('onWSMessage', (event: any) => {
            if (event.messageData?.message?.type === 'agent_connected') {
                var snd = new Audio(me.notificationSound);
                snd.play();
            }

            if (event.messageData?.type === 'bot_response' && event.messageData?.message[0]?.component?.payload?.payload?.template_type === 'live_agent' && event.messageData?.message[0]?.component?.payload?.payload?.text) {
                if (Notification.permission !== "granted") return;

                const text = event.messageData?.message[0]?.component?.payload?.payload?.text;
                const options = {
                    body: text,
                    sound: this.notificationSound,
                    requireInteraction: false,
                    onclick: (event: any) => {
                        event.target.close();
                    }
                }
                let notification: any;
                
                if (!me.isTabActive) {

                    if (event.messageData.author?.firstName) {
                        const agentName = event.messageData.author.firstName + " " + event.messageData.author.lastName;
                        notification = new Notification("New message from " + agentName, options);
                    } else {
                        notification = new Notification("You have a new notification.", options);
                    }
                    
                    var snd = new Audio(this.notificationSound);
                    snd.play();
                }
                if (notification) {
                    notification.onclick = function (event: any) {
                        window.parent.focus();
                        notification.close();
                    };
                }
            }
        });
    }
}

export default KoreDesktopNotificationPlugin;